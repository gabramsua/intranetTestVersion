{% extends 'intranetBundle::layout.html.twig' %}

{% block contenido %}
<script>
            var app = angular.module('MyApp',['ngRoute', 'ngMaterial', 'ngMessages', 'material.svgAssetsCache', 'ngMdIcons']);
            app.config(function($interpolateProvider){
                $interpolateProvider.startSymbol('{[{').endSymbol('}]}');
            });

            app.controller('newsController', newsController);
            
            
            function newsController($scope, $http){

                $scope.getAllNews = function(){
                    $http({
                        method: 'GET',
                        url: window.location.pathname+'/../../api/news/Canal1',
                        dataType: 'json',
                        headers: {'Content-Type': 'application/json'}
                    })
                    .then(function success(response){
                        $scope.newsList = response.data;
                        console.log($scope.newsList);
                    }, function error(response){
                        console.log("Error:" +response.statusText);
                    });
                }


                $scope.deleteNew = function(id){
                    
                    $http({
                        method: 'DELETE',
                        url: window.location.pathname+'/../../api/new/'+id,
                        dataType: 'json',
                        headers: {'Content-Type': 'application/json'}
                    })
                    .then(function success(response){
                         $scope.getAllNews();
                    }, function error(response){
                        console.log("Error al delete:" +response.statusText);
                    });
                }

                $scope.readNewDialog = function(ev, new) {
                    $mdDialog.show({
                        templateUrl: "{{path('intranet_main_new_dialog')}}",
                        locals: {
                            currentNew: new
                        }, 
                        parent: angular.element(document.body),
                        targetEvent: ev,
                        clickOutsideToClose: true,
                        controller: updateNewDialogController,
                        onRemoving: $scope.getAllNews
                    });
                    //alert(user.name);
                }

                $scope.showCreateNewDialog = function(ev) {
                    
                    $mdDialog.show({
                        templateUrl: "{{path('intranet_main_create_channel_dialog')}}",
                        parent: angular.element(document.body),
                        targetEvent: ev,
                        clickOutsideToClose: true,
                        controller: createNewDialogController,
                        onRemoving: $scope.getAllNews
                    });
                }
            }


            function createNewDialogController($scope, $mdDialog, $http){

                $listChecked=[];

                $scope.getInfo = function(){
                    
                    $http({
                        method: 'GET',
                        url: window.location.pathname+'/../../api/channels',
                        dataType: 'json',
                        headers: {'Content-Type': 'application/json'}
                    })
                    .then(function success(response){
                        $scope.allChannels = response.data;
                        console.log($scope.allChannels);
                    }, function error(response){
                        console.log("Error:" +response.statusText);
                    });
                }
                
                $scope.closeDialog = function() {
                    $mdDialog.hide();
                };

                $scope.alreadyIn = function(user){
                
                    return ($listChecked).indexOf(channel.name) > -1;
                };
                
                $scope.toggle = function(channel){
                    //console.log(channel.name);
                    var index = ($listChecked).indexOf(channel.name);

                    if (index > -1){
                        ($listChecked).splice(index, 1);
                    }
                    else{
                        ($listChecked).push(channel.name);
                    }
                    //console.log($listChecked);

                };  

/*                $scope.create=function(){
                    
                    $notID=-1;
                    //Recoger los datos del modal y pasarlos a la bd mediante AJAX?
                    $http({
                        method: 'POST',
                        url: window.location.pathname+'/../../api/new/'+$notID,
                        data: {
                            name: $scope.channel.name,
                            usersInChannel: $listChecked
                        },
                        contentType: 'application/json',
                        dataType: 'json',
                        headers: {'Content-Type': 'application/json'}
                    })
                    .then(function success(response){
                        console.log("Party time");
                        $scope.closeDialog();
                    }, function error(response){
                        console.log("Error:" +response.statusText);
                    });   
                };   */  
            }

</script>








    <div ng-cloak ng-app="MyApp" ng-controller="newsController" layout-align="center start">
    
    <md-list ng-init="getAllNews()">
    <md-button class="md-raised md-primary" ng-click="showCreateNewDialog($event)">Create New</md-button>
        <md-divider></md-divider>
        <md-divider></md-divider>

        <md-list-item style="font-size: large" ng-model="prueba">
            <span style="width: 100%">Title</span>
            <span style="width: 50%">Content</span>
        </md-list-item>

        <md-divider></md-divider>
        <md-divider></md-divider>

        <div ng-repeat="new in newsList">
            <md-list-item ng-click="readNewDialog($event, new)">
    
                <span style="width: 100%">{[{ new.title }]}</span>
                <!--<span style="width: 50%">{[{ new.content }]}</span>-->
                <div>
                    <md-button style="width: 10%" class="md-raised md-warn md-secondary" ng-click="deleteNew(new.id)">
                        Delete
                    </md-button> 
                </div>
            
            </md-list-item>
            <md-divider></md-divider>
        </div>
    </md-list>
</div>

{% endblock %}